/*! For license information please see 168.90c66fc2.chunk.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[168],{22071:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var a=r(22072),i=r(15463),n=r(17448),c=r(13087),s=new a.a(c.a,i.a,n.a)},22072:function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var a=r(14940),i=r(13009),n=r(15522),c=r(13083),s=r(13085);function o(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,l(a.key),a)}}function l(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var u=function(){function e(t,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.loggingService=t,this.xrmWorkflowHttpClient=r,this.graphService=i,this.cancelTokenSource=Object(a.a)(),this.minimumNumberOfSearchCharacters=2}var t,r,l;return t=e,(r=[{key:"getPeoplePickerSuggestionsWithoutDeactivatedUsers",value:function(e){return this.getPeoplePickerSuggestionsInternal(e,!0)}},{key:"getPeoplePickerSuggestions",value:function(e){return this.getPeoplePickerSuggestionsInternal(e,!1)}},{key:"getPeoplePickerSuggestionsUsersOnly",value:function(e){return this.cancelTokenSource.cancel("Canceled due to text change"),this.cancelTokenSource=Object(a.a)(),Object(c.a)(e)||e.trim().length<this.minimumNumberOfSearchCharacters?Promise.resolve({tooFewCharactersInSearch:!0}):this.getUsers(e,this.cancelTokenSource.token).then(e=>({items:e}))}},{key:"getGraphAndDVPeoplePickerSuggestions",value:function(e){if(this.cancelTokenSource.cancel("Canceled due to text change"),this.cancelTokenSource=Object(a.a)(),Object(c.a)(e)||e.trim().length<this.minimumNumberOfSearchCharacters)return Promise.resolve({tooFewCharactersInSearch:!0});var t=this.graphService.getPeoplePickerSuggestions(e,this.cancelTokenSource.token),r=this.getTeams(e,this.cancelTokenSource.token,n.a.DataverseTeam);return Promise.all([t,r]).then(e=>{var t,[r,a]=e;return{items:this.dedupeAADGroupsAndDVTeams(null!==(t=r.items)&&void 0!==t?t:[],a)}})}},{key:"getDVUserByIdAsPeoplePickerItem",value:function(e){return this.xrmWorkflowHttpClient.getXrmSystemUser(e).then(e=>{if(200===e.status&&e.data)return{text:e.data.fullname,uniqueId:e.data.systemuserid,secondaryText:e.data.internalemailaddress,mail:e.data.internalemailaddress,type:n.a.User,data:{aadObjectId:e.data.azureactivedirectoryobjectid||"",isDisabled:"".concat(e.data.isdisabled&&!e.data.islicensed).toLowerCase(),xrmSystemUserApplicationId:e.data.applicationid||""}}})}},{key:"getPeoplePickerSuggestionsInternal",value:function(e,t){if(this.cancelTokenSource.cancel("Canceled due to text change"),this.cancelTokenSource=Object(a.a)(),Object(c.a)(e)||e.trim().length<this.minimumNumberOfSearchCharacters)return Promise.resolve({tooFewCharactersInSearch:!0});var r=this.getUsers(e,this.cancelTokenSource.token,t),i=this.getTeams(e,this.cancelTokenSource.token);return Promise.all([r,i]).then(e=>{var[t,r]=e;return{items:[...t,...r]}})}},{key:"dedupeAADGroupsAndDVTeams",value:function(e,t){var r=new Set;return t.forEach(e=>{var t;null!==(t=e.data)&&void 0!==t&&t.azureactivedirectoryobjectid&&r.add(e.data.azureactivedirectoryobjectid)}),[...e.filter(e=>!r.has(e.uniqueId)),...t]}},{key:"getUsers",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=this.loggingService.profileStart(s.a.rpaXrmSearchSystemUsersStart);return this.xrmWorkflowHttpClient.searchXrmSystemUsers(e,t,r).then(e=>(this.loggingService.profileEndWithSuccess(c,s.a.rpaXrmSearchSystemUsersEnd),(e.data.value||[]).map(e=>({text:e.fullname,uniqueId:e.systemuserid,secondaryText:e.internalemailaddress,mail:e.internalemailaddress,type:n.a.User,data:{aadObjectId:e.azureactivedirectoryobjectid||"",isDisabled:"".concat(e.isdisabled&&!e.islicensed).toLowerCase(),xrmSystemUserApplicationId:e.applicationid||""}})))).catch(e=>{this.loggingService.profileEnd(c,s.a.rpaXrmSearchSystemUsersEnd,Object(i.y)(e),e);var t=Object(i.cb)(e),r=Object(i.db)(e),n=new i.a(t,r,e);return Object(a.b)(e)||this.loggingService.logError("XrmUserService.getPeoplePickerSuggestions",n),Promise.reject(n)})}},{key:"getTeams",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.a.Group,c=this.loggingService.profileStart(s.a.rpaXrmSearchTeamsStart);return this.xrmWorkflowHttpClient.searchXrmTeams(e,t).then(e=>(this.loggingService.profileEndWithSuccess(c,s.a.rpaXrmSearchTeamsEnd),(e.data.value||[]).map(e=>({text:e.name,uniqueId:e.teamid,secondaryText:e.emailaddress||"",mail:e.emailaddress||"",type:r,data:{azureactivedirectoryobjectid:e.azureactivedirectoryobjectid||""}})))).catch(e=>{this.loggingService.profileEnd(c,s.a.rpaXrmSearchTeamsEnd,Object(i.y)(e),e);var t=Object(i.cb)(e),r=Object(i.db)(e),n=new i.a(t,r,e);return Object(a.b)(e)||this.loggingService.logError("XrmUserService.getPeoplePickerSuggestions",n),Promise.reject(n)})}}])&&o(t.prototype,r),l&&o(t,l),Object.defineProperty(t,"prototype",{writable:!1}),e}()}}]);
//# sourceMappingURL=https://sourcemaps.powerapps.com/srcmaps/static/js/module/168.90c66fc2.chunk.js.map